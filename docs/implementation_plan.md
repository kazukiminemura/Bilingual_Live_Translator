フェーズ概要
• Phase 1: Walking Skeleton：音声→翻訳→表示の最小経路を構築しMVPを成立させる／#1-6
• Phase 2: 自動化：翻訳履歴と表示設定APIで操作性を高める／#7-8
• Phase 3: 堅牢化：例外処理とテストで安定性を確保する／#9-10

依存関係マップ
1 → 2 → 5 → 6  
1 → 3 → 4 → {5,7,10}  
1 → 8 → 9  
7 → 9  
7 → 10  
8 → 10  

Issueアウトライン表
Issue #1: FastAPIスケルトンの構築
• 概要: FastAPIでHTMLとWebSocketを提供する最小構成を作成する
• 依存: ー
• ラベル/担当: backend
• 受け入れ基準（AC）:
- [ ] `/` が `index.html` を返す
- [ ] `/ws` でWebSocket接続を受け付ける
- [ ] 接続中クライアントをセットで管理する
- [ ] 簡単なログ出力を行う
- [ ] READMEに起動手順を記載する

Issue #2: フロントエンド音声送信
• 概要: ブラウザからマイク音声を取得しWebSocketで送信する
• 依存: #1
• ラベル/担当: frontend
• 受け入れ基準（AC）:
- [ ] MediaRecorderで16kHzモノラル音声を取得
- [ ] 2秒ごとに音声バイトをWebSocket送信
- [ ] 送信開始・停止ボタンを実装
- [ ] エラー時にユーザーへメッセージ表示

Issue #3: faster-whisperによる音声認識
• 概要: 受信した音声をローカルSTTでテキスト化する
• 依存: #1
• ラベル/担当: backend
• 受け入れ基準（AC）:
- [ ] faster-whisperモデルをローカル読み込み
- [ ] 受信音声をテキスト化し言語を判定
- [ ] デバイス選択（CPU/GPU/NPU）に対応
- [ ] 認識結果をログとWebSocketで出力

Issue #4: M2M100翻訳パイプライン
• 概要: STT結果をfacebook/m2m100_418Mで相互翻訳する
• 依存: #3
• ラベル/担当: backend
・ 受け入れ基準（AC）:
- [ ] Hugging Faceパイプラインを初期化
- [ ] ja→en / en→ja の両方向に対応
- [ ] 翻訳時間をログ出力
- [ ] モデル読み込み失敗時にエラー通知

Issue #5: 翻訳結果のリアルタイム表示
• 概要: 認識・翻訳結果をWebSocket経由で画面に表示する
• 依存: #2, #4
• ラベル/担当: frontend, backend
• 受け入れ基準（AC）:
- [ ] サーバーから原文・訳文をJSONで送信
- [ ] ブラウザで原文と訳文を色分け表示
- [ ] 翻訳方向切替ボタンを設置
- [ ] 非同期処理でUIがブロックされない
- [ ] 表示履歴が直近数件保持される

Issue #6: Docker実行環境の整備
• 概要: アプリをDockerで再現可能な環境にする
• 依存: #5
• ラベル/担当: infra
• 受け入れ基準（AC）:
- [ ] 必要パッケージを含むDockerfile作成
- [ ] `docker run` でアプリ起動しブラウザアクセス可能
- [ ] イメージビルド手順をREADMEに追記
- [ ] モデルダウンロード手順を記載

Issue #7: 翻訳履歴API実装
• 概要: 翻訳結果を保存しRESTで取得できるようにする
• 依存: #4
• ラベル/担当: backend
• 受け入れ基準（AC）:
- [ ] メモリ上に履歴をID付きで保存
- [ ] POST `/api/translations` が翻訳と保存を行う
- [ ] GET `/api/translations` が履歴一覧を返す
- [ ] リクエストの必須項目を検証する
- [ ] 簡易ユニットテストを追加

Issue #8: 表示設定API実装
• 概要: 字幕表示設定をRESTで取得・更新できるようにする
• 依存: #1
• ラベル/担当: backend
• 受け入れ基準（AC）:
- [ ] メモリ上に設定（フォントサイズ・色）を保持
- [ ] GET `/api/settings` が現在設定を返す
- [ ] POST `/api/settings` が指定項目を更新
- [ ] 色は `#RRGGBB`、フォントサイズは正数にバリデート
- [ ] 更新後の設定が再取得で反映される

Issue #9: 例外処理と統一エラーレスポンス
• 概要: WebSocketとREST双方のエラーを統一形式で返す
• 依存: #7, #8
• ラベル/担当: backend
• 受け入れ基準（AC）:
- [ ] エラーレスポンスに`{error:{code,message}}`形式を使用
- [ ] WebSocket切断時に原因をログへ記録
- [ ] モデル読み込み失敗時に起動中断と詳細ログ出力
- [ ] デバッグモードのON/OFF切替を環境変数で制御

Issue #10: 基本テストとCI導入
• 概要: 翻訳とAPIの主要機能をpytestで検証する
• 依存: #4, #7, #8
• ラベル/担当: backend, infra
• 受け入れ基準（AC）:
- [ ] サンプル音声でSTT結果を検証するテスト
- [ ] 翻訳「Hello→こんにちは」を確認するテスト
- [ ] REST APIのGET/POSTをテスト
- [ ] CIでpytestが自動実行される

■ 実装要事項（任意）
- 疑問課題:
- 翻訳履歴の永続化はメモリのみで良いか、ファイル保存が必要か
- 音声ストリーミングのチャンクサイズやサンプリング方式をどう最適化するか
- 翻訳方向切替のUI仕様（自動判定か手動選択か）
- モデルの初期ダウンロードをDockerビルド時に行うか起動時に行うか
